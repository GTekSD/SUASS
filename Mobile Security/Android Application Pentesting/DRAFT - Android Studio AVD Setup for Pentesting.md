# Android Virtual Device

### How to create and manage android virtual devices

https://developer.android.com/studio/run/managing-avds#createavd

### How to Install ADB (Android SDK Platform-Tools)
* Open Android Studio -> SDK Manager -> Android SDK -> SDK Tools -> Check on **Android SDK Platform-Tools** -> Apply

  <img src="https://user-images.githubusercontent.com/37043777/140064719-ea2dd704-1aea-4c38-9725-3edbdafe7924.png" width="800" />

### Setting Up Proxy with BurpSuite
* Go to the Proxy tab and then click Options.
* Under Proxy Listeners, click the Add button to create a new proxy listener.

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/677e17bf-92ab-49e1-bd91-62b57b981a43" width="800" />

* Enter the port number (Ex: 8082), select "All interfaces" and click ok.

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/a6e387cc-c68b-4026-9a50-e6345412dde1" width="800" />


1. Turn off "Mobile Data" on your Android virtual device (AVD).

<img src="https://github.com/GTekSD/SUASS/assets/55411358/692cef90-3f69-4407-9b74-441031c05dc2" width="500" />

3. Navigate to Wi-Fi settings and tap on the ⚙️ icon.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/1d777c60-ea7c-4e27-9b9e-15d4c4e681e0" width="500" />

4. Edit Proxy Configuration, Tap on the ✏️ icon.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/c325f591-3ad1-4d55-b7bc-61f26bab876b" width="500" />

5. Set Proxy Configuration, In the "AndroidWifi" window, select "Proxy" and set it to "Manual". Fill in "Proxy hostname" with your system's IP address and "Proxy port" with the port you have set in Burp Suite (ex. 8090). Click on "Save" to apply the changes.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/af4b97fb-6e84-418f-b58f-cbdcf321270a" width="500" />

6. Open your AVD's browser and enter "burp/" or "http://burp/" in the address/url bar. The Burp Suite CA certificate page will load. Click on "CA Certificate" to download it.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/917838e9-5232-4139-999c-a4d71b02053c" width="500" />

7. After downloading, rename the downloaded file `cacert.der` to `cacert.crt`.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/51983ef9-16ab-47a0-9cfb-a1715c0f508b" width="500" />

8. Open device Settings, navigate to Security > Encryption & Credentials > Install a certificates (Install certificates from SD card). Click on "CA certificate" and select the `cacert.crt` file from your Downloads.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/b510f9e0-6240-4410-acde-f37482702bb9" width="500" />

<img src="https://github.com/GTekSD/SUASS/assets/55411358/458f251b-1477-4dee-9011-cf423a8d7055" width="500" />

9. Once installed, a "CA certificate installed" toast notification will appear.

<img src="https://github.com/GTekSD/SUASS/assets/55411358/c39c798e-d15b-4764-8052-ab4a6d586dfc" width="500" />

11. To crosscheck, go to Settings > Security > Trusted Credentials > USER. If it shows "PortSwigger", the certificate is installed correctly.
  
<img src="https://github.com/GTekSD/SUASS/assets/55411358/783e93ca-ad00-4fcc-994e-1609b9152190" width="500" />


11. You are now ready to intercept requests using Burp Suite.


<img src=" " width="800" />


------- 

OPTIONAL
* Now, we will export the CA certificates from burp.
* Under the same tab, click on the "Import / export CA certificate" button.

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/4860a7f3-414a-49bd-905b-a0e8203b46be" width="800" />
  
* Export it as DER format but save it with the .crt extension.

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/f0d49391-730a-4e7f-bf9d-9f0776aed859" width="800" />

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/f03d55fc-b197-40e9-9465-ace3610cc3c1" width="800" />

  <img src="https://github.com/GTekSD/SUASS/assets/55411358/3ea67440-593b-4c5a-a47d-7c2442a0dd45" width="800" />

* With the emulator open, click More `...` then Extended Controls
  ![ad extended ctrs](https://github.com/GTekSD/SUASS/assets/55411358/dc0ea63b-ec14-4215-8880-ee1d220d4a29)
  
* Click Settings and Proxy.
* Define your HTTP proxy settings.
  
  <img src="https://blog.yarsalabs.com/content/images/2022/06/image-10.png" width="800" />
  
* To transfer the Burp certs into your device for installation, you can simply drag and drop the `.crt` certificate into the emulator, or you can use adb to push the file to the AVD.
* Once you transfer the certificate, go to Settings > Security > Encryption & Credentials. Then click on the "Install certificates from SD card" option.

  <img src="https://blog.yarsalabs.com/content/images/2022/06/image-14.png" width="800" />

* Select the Certificate file. If you dragged and dropped the file, it will be under `/sdcard/Downloads`.

  <img src="https://blog.yarsalabs.com/content/images/2022/06/image-19.png" width="800" />

-----------
