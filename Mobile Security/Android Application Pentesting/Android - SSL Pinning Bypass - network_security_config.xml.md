## Bypass-Android-SSL-Pinning


First pull the android application from your device using adb

```
$ adb pull ./pathto/test.apk
```

Decompile the application using apktool

```
$ apktool d test.apk
```

Edit the `network_security_config.xml` file in `/base/res/xml` directory

network_security_config.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config>
        <domain includeSubdomains="true">api.testingdomain.com</domain>
        <domain includeSubdomains="true">staging-api.testingdomain.com</domain>
        <pin-set>
            <pin digest="SHA-256">YyKlrbMBaYz9er5JY/8asdfhpoXhUJY9ZZUycEPcDoU7w2s=</pin>
            <pin digest="SHA-256">AoqlvZFWR5AIer/asdfDL0AvjqxtHCydEHF0WdTRitLKCY=</pin>
        </pin-set>
    </domain-config>
</network-security-config>
```
Remove `<pin-set>...</pin-set>` and add the `trust-anchors`tag and make it look like below

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config>
        <domain includeSubdomains="true">api.testingdomain.com</domain>
        <domain includeSubdomains="true">staging-api.testingdomain.com</domain>
        <trust-anchors>
            <certificates src="user" />
            <certificates src="system" />
        </trust-anchors>
    </domain-config>
</network-security-config>
```
cd to application root directory and build the application again using apktool

```
$ apktool b ./
```

apktool will save the new modified apk in `dist` directory, Now generate the private key using keytool.

```
$ keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000
Enter keystore password:  
Re-enter new password: 
What is your first and last name?
  [Unknown]:  test
What is the name of your organizational unit?
  [Unknown]:  test
What is the name of your organization?
  [Unknown]:  test
What is the name of your City or Locality?
  [Unknown]:  test
What is the name of your State or Province?
  [Unknown]:  test
What is the two-letter country code for this unit?
  [Unknown]:  US
Is CN=test, OU=test, O=test, L=test, ST=test, C=US correct?
  [no]:  yes

Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 10,000 days
	for: CN=test, OU=test, O=test, L=test, ST=test, C=US
[Storing my-release-key.keystore]
```

Sign the modified application with the generated private key using jarsigner

```
$ jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore test.apk alias_name
```

Uninstall the old application from the device and install the new application

```
$ adb install test.apk
```

Done! now you can intercept the request with burpsuite.


# SSL Pinning Bypass using Frida in Android

SSL Pinning is a common security measure implemented in many Android applications to prevent their execution on rooted devices. However, with tools like Frida, it's possible to bypass such detection mechanisms. This guide will walk you through the process of bypassing SSL Pinning using Frida in Android.

## Prerequisites

Before getting started,

- Ensure you have good rooted device or emulators:
  - [NoxPlayer](https://www.bignox.com/)
  - [Genymotion](https://www.genymotion.com/product-desktop/download/)
  - [Android Studio](https://developer.android.com/studio)
- Python from [Microsoft Store](https://apps.microsoft.com/detail/9ncvdn91xzqp?hl=en-us&gl=US)

### Setup Frida:

1. Install Frida by using following commands:

    ```bash
    python -m pip install frida
    python -m pip install frida-tools
    ```

    Alternatively, you can install them directly using pip:
  
    ```bash
    pip install frida
    pip install frida-tools
    ```
2. Add frida into Environment Variables
    * Open the "Environment Variables" window
    * Select the Path variable under "System Variables" and click the "Edit" button
    * Click the "New" button
    * Insert path `%USERPROFILE%\AppData\Local\Programs\Python\Python312\Scripts` in the text field

3. Run below command to verify if Frida is installed properly
   ```
   frida -h
   ```
   Frida is properly installed if help is displayed.

### Setup ADB - Android Debug Bridge

Check this [ADB and Fastboot setup](./ADB%20and%20Fastboot%20Setup.md) guide.

## Steps

### 1. Connect ADB Device

Connect the rooted device with wired, and run the following command to identify connected device:
```bash
adb devices
```
In result it will show the device ID as following:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
J9AAGF002486Y9M device
```

If you are using emulator, then directly run the above command. in result it will show you the above:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
127.0.0.1:62001 device
```

### 2. Identify CPU Architecture

First, identify the CPU architecture of the target device by executing the following command:

```bash
adb shell getprop ro.product.cpu.abi
```
In my case, it was:
```
x86
```
### 3. Download Frida Server

Download the appropriate Frida server android binary from the [official Frida releases page](https://github.com/frida/frida/releases/), based on the CPU architecture obtained in the previous step.

In my case, it was `frida-server-16.2.1-android-x86.xz`

### 4. Push Files to Device

1. Before pushing it, extract downloaded Frida server android binary file using [WinRAR](https://www.win-rar.com/download.html?&L=0) or [7-zip](https://www.7-zip.org/download.html)

In Linux, run this command:
```bash
unxz frida-server.xz
```

2. Push the extracted Frida server binary to the device:

  ```bash
  adb push frida-server-16.2.1-android-x86 /data/local/tmp
  ```

3. Make it executable:

  ```bash
  adb shell chmod 755 /data/local/tmp/frida-server-16.2.1-android-x86
  ```

### 5. Start Frida Server

Start the Frida server on the device:

```bash
adb shell "/data/local/tmp/frida-server-16.2.1-android-x86 &"
```
Alternative, If it dosent work:

```bash
adb shell /data/local/tmp/frida-server-16.2.1-android-x86
```
Still?

```bash
adb shell
cd /data/local/tmp/
./frida-server-16.2.1-android-x86
```

### 6. Check Package Name

Now, open a new terminal.

Use `frida-ps` command to identify the package name of the target application:

```bash
frida-ps -Ua
```
If it dosen't show, then open the target application and then run command again.

### 7. Execute Frida Script

Execute the Frida script to bypass SSL Pinning for the target application, but first, you need to download a javascript file, Download form [here](./r0oT_d3tecTi0n_byp@s5.js)

Now open the targeted app that you wanted to bypass SSL Pinning, then run the following command:

If you have downloaded script:
```bash
frida -U -f com.example.app -l Downloaded_script.js
```

Frida always comes up with multiple scripts that allow the bypass of the Android’s SSL Pinning mechanism, but there would be no guarantee that any of the scripts would work. You can find such scripts on Frida’s codeshare, like the ones given below:

```bash
frida -U -f com.example.app --codeshare pcipolloni/universal-android-ssl-pinning-bypass-with-frida
```

- https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/
- https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/
- https://codeshare.frida.re/@sowdust/universal-android-ssl-pinning-bypass-2/ 


Replace `com.example.app` with the actual package name of the target application.


_N0te: You can remember this command as "Frida yo**u** **f**uck example.app and use **l**ub script.js"_


# SSL Pinning Bypass using Objection in Android

### Setup Objection:

1. Install Objection by using following commands:

    ```bash
    python -m pip install objection
    ```

    Alternatively, you can install them directly using pip:
  
    ```bash
    pip install objection
    ```
2. Add Objection into Environment Variables
    * Open the "Environment Variables" window
    * Select the Path variable under "System Variables" and click the "Edit" button
    * Click the "New" button
    * Insert path `%USERPROFILE%\AppData\Local\Programs\Python\Python312\Scripts` in the text field

3. Run below command to verify if Frida is installed properly
   ```
   objection --help
   ```
   Objection is properly installed if help is displayed.

### Setup ADB - Android Debug Bridge

Check this [ADB and Fastboot setup](./ADB%20and%20Fastboot%20Setup.md) guide.

## Steps

### 1. Connect ADB Device

Connect the rooted device with wired, and run the following command to identify connected device:
```bash
adb devices
```
In result it will show the device ID as following:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
J9AAGF002486Y9M device
```

If you are using emulator, then directly run the above command. in result it will show you the above:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
127.0.0.1:62001 device
```

### 2. Check Package Name

Use `frida-ps` command to identify the package name of the target application:

```bash
frida-ps -Ua
```
If it dosen't show, then open the target application and then run command again.

### 3. Bypass SSL Pinning 

By exploring the application using objection, you can easily try to bypass the SSL Pinning by simply calling the android sslpinning disable method, as in the following:

```bash
objection -g com.example.app explore
```
```bash
[usb]> android sslpinning disable
```

Replace `com.example.app` with the actual package name of the target application.


### BOOM! BYPASSED!

With these steps, you should be able to bypass SSL Pinning in Android applications using Frida and Objection. It's essential to understand that bypassing security measures like SSL Pinning may have legal implications and should only be performed on applications you have explicit permission to test or modify. Use this knowledge responsibly and ethically.
