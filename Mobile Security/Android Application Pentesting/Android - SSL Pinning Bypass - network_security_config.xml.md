## Bypass-Android-SSL-Pinning


First pull the android application from your device using adb

```
$ adb pull ./pathto/test.apk
```

Decompile the application using apktool

```
$ apktool d test.apk
```

Edit the `network_security_config.xml` file in `/base/res/xml` directory

network_security_config.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config>
        <domain includeSubdomains="true">api.testingdomain.com</domain>
        <domain includeSubdomains="true">staging-api.testingdomain.com</domain>
        <pin-set>
            <pin digest="SHA-256">YyKlrbMBaYz9er5JY/8asdfhpoXhUJY9ZZUycEPcDoU7w2s=</pin>
            <pin digest="SHA-256">AoqlvZFWR5AIer/asdfDL0AvjqxtHCydEHF0WdTRitLKCY=</pin>
        </pin-set>
    </domain-config>
</network-security-config>
```
Remove `<pin-set>...</pin-set>` and add the `trust-anchors`tag and make it look like below

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config>
        <domain includeSubdomains="true">api.testingdomain.com</domain>
        <domain includeSubdomains="true">staging-api.testingdomain.com</domain>
        <trust-anchors>
            <certificates src="user" />
            <certificates src="system" />
        </trust-anchors>
    </domain-config>
</network-security-config>
```
cd to application root directory and build the application again using apktool

```
$ apktool b ./
```

apktool will save the new modified apk in `dist` directory, Now generate the private key using keytool.

```
$ keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000
Enter keystore password:  
Re-enter new password: 
What is your first and last name?
  [Unknown]:  test
What is the name of your organizational unit?
  [Unknown]:  test
What is the name of your organization?
  [Unknown]:  test
What is the name of your City or Locality?
  [Unknown]:  test
What is the name of your State or Province?
  [Unknown]:  test
What is the two-letter country code for this unit?
  [Unknown]:  US
Is CN=test, OU=test, O=test, L=test, ST=test, C=US correct?
  [no]:  yes

Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 10,000 days
	for: CN=test, OU=test, O=test, L=test, ST=test, C=US
[Storing my-release-key.keystore]
```

Sign the modified application with the generated private key using jarsigner

```
$ jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore test.apk alias_name
```

Uninstall the old application from the device and install the new application

```
$ adb install test.apk
```

Done! now you can intercept the request with burpsuite.


# SSL Pinning Bypass using Frida in Android

SSL Pinning is a common security measure implemented in many Android applications to prevent their execution on rooted devices. However, with tools like Frida, it's possible to bypass such detection mechanisms. This guide will walk you through the process of bypassing SSL Pinning using Frida in Android.

## Prerequisites

Before getting started,

- Ensure you have good rooted device or emulators:
  - [NoxPlayer](https://www.bignox.com/)
  - [Genymotion](https://www.genymotion.com/product-desktop/download/)
  - [Android Studio](https://developer.android.com/studio)
- Python from [Microsoft Store](https://apps.microsoft.com/detail/9ncvdn91xzqp?hl=en-us&gl=US)

### Setup Frida:

1. Install Frida by using following commands:

    ```bash
    python -m pip install frida
    python -m pip install frida-tools
    ```

    Alternatively, you can install them directly using pip:
  
    ```bash
    pip install frida
    pip install frida-tools
    ```
2. Add frida into Environment Variables
    * Open the "Environment Variables" window
    * Select the Path variable under "System Variables" and click the "Edit" button
    * Click the "New" button
    * Insert path `%USERPROFILE%\AppData\Local\Programs\Python\Python312\Scripts` in the text field

3. Run below command to verify if Frida is installed properly
   ```
   frida -h
   ```
   Frida is properly installed if help is displayed.

### Setup ADB - Android Debug Bridge

Check this [ADB and Fastboot setup](./ADB%20and%20Fastboot%20Setup.md) guide.

## Steps

### 1. Connect ADB Device

Connect the rooted device with wired, and run the following command to identify connected device:
```bash
adb devices
```
In result it will show the device ID as following:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
J9AAGF002486Y9M device
```

If you are using emulator, then directly run the above command. in result it will show you the above:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
127.0.0.1:62001 device
```

### 2. Identify CPU Architecture

First, identify the CPU architecture of the target device by executing the following command:

```bash
adb shell getprop ro.product.cpu.abi
```
In my case, it was:
```
x86
```
### 3. Download Frida Server

Download the appropriate Frida server android binary from the [official Frida releases page](https://github.com/frida/frida/releases/), based on the CPU architecture obtained in the previous step.

In my case, it was `frida-server-16.2.1-android-x86.xz`

### 4. Push Files to Device

1. Before pushing it, extract downloaded Frida server android binary file using [WinRAR](https://www.win-rar.com/download.html?&L=0) or [7-zip](https://www.7-zip.org/download.html)

In Linux, run this command:
```bash
unxz frida-server.xz
```

2. Push the extracted Frida server binary to the device:

  ```bash
  adb push frida-server-16.2.1-android-x86 /data/local/tmp
  ```

3. Make it executable:

  ```bash
  adb shell chmod 755 /data/local/tmp/frida-server-16.2.1-android-x86
  ```

### 5. Start Frida Server

Start the Frida server on the device:

```bash
adb shell "/data/local/tmp/frida-server-16.2.1-android-x86 &"
```
Alternative, If it dosent work:

```bash
adb shell /data/local/tmp/frida-server-16.2.1-android-x86
```
Still?

```bash
adb shell
cd /data/local/tmp/
./frida-server-16.2.1-android-x86
```

### 6. Check Package Name

Now, open a new terminal.

Use `frida-ps` command to identify the package name of the target application:

```bash
frida-ps -Ua
```
If it dosen't show, then open the target application and then run command again.

### 7. Execute Frida Script

Execute the Frida script to bypass SSL Pinning for the target application, but first, you need to download a javascript file, Download form [here](./r0oT_d3tecTi0n_byp@s5.js)

Now open the targeted app that you wanted to bypass SSL Pinning, then run the following command:

If you have downloaded script:
```bash
frida -U -f com.example.app -l Downloaded_script.js
```

Frida always comes up with multiple scripts that allow the bypass of the Android’s SSL Pinning mechanism, but there would be no guarantee that any of the scripts would work. You can find such scripts on Frida’s codeshare, like the ones given below:

```bash
frida -U -f com.example.app --codeshare pcipolloni/universal-android-ssl-pinning-bypass-with-frida
```

- https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/
- https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/
- https://codeshare.frida.re/@sowdust/universal-android-ssl-pinning-bypass-2/ 


Replace `com.example.app` with the actual package name of the target application.


_N0te: You can remember this command as "Frida yo**u** **f**uck example.app and use **l**ub script.js"_


# SSL Pinning Bypass using Objection in Android

### Setup Objection:

1. Install Objection by using following commands:

    ```bash
    python -m pip install objection
    ```

    Alternatively, you can install them directly using pip:
  
    ```bash
    pip install objection
    ```
2. Add Objection into Environment Variables
    * Open the "Environment Variables" window
    * Select the Path variable under "System Variables" and click the "Edit" button
    * Click the "New" button
    * Insert path `%USERPROFILE%\AppData\Local\Programs\Python\Python312\Scripts` in the text field

3. Run below command to verify if Frida is installed properly
   ```
   objection --help
   ```
   Objection is properly installed if help is displayed.

### Setup ADB - Android Debug Bridge

Check this [ADB and Fastboot setup](./ADB%20and%20Fastboot%20Setup.md) guide.

## Steps

### 1. Connect ADB Device

Connect the rooted device with wired, and run the following command to identify connected device:
```bash
adb devices
```
In result it will show the device ID as following:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
J9AAGF002486Y9M device
```

If you are using emulator, then directly run the above command. in result it will show you the above:
```bash
PS D:\ADB-Platform-Tools\> adb devices
List of devices attached
127.0.0.1:62001 device
```

### 2. Check Package Name

Use `frida-ps` command to identify the package name of the target application:

```bash
frida-ps -Ua
```
If it dosen't show, then open the target application and then run command again.

### 3. Bypass SSL Pinning 

By exploring the application using objection, you can easily try to bypass the SSL Pinning by simply calling the android sslpinning disable method, as in the following:

```bash
objection -g com.example.app explore
```
```bash
[usb]> android sslpinning disable
```

Replace `com.example.app` with the actual package name of the target application.


### BOOM! BYPASSED!

With these steps, you should be able to bypass SSL Pinning in Android applications using Frida and Objection. It's essential to understand that bypassing security measures like SSL Pinning may have legal implications and should only be performed on applications you have explicit permission to test or modify. Use this knowledge responsibly and ethically.

# SSL Pinning Bypass for Flutter APKs in Android

[reFlutter](https://github.com/Impact-I/reFlutter) is a tool designed to assist with reverse engineering Flutter applications. It facilitates the process of unpacking, modifying, and repacking Flutter apps.

### Setup reFlutter:

1. Install reFlutter for Linux, Windows, MacOS by using following commands:
   ```bash
   python -m pip install reflutter
   ```
   Alternatively, you can install them directly using pip:
   ```bash
   pip3 install reflutter==0.7.8
   ```

2. Adding `reflutter` to your environment variables can make it easier to run the tool from any directory in your terminal. Here’s a step-by-step guide for adding `reflutter` to your PATH on Windows operating systems:

1. **Find the Path to reflutter**:
   - If you installed `reflutter` via `pip`, it is typically located in the `Scripts` folder of your Python installation directory. You can find the path by running:
     ```cmd
     where reflutter
     ```
     Output:
     ```cmd
     C:\Users\gteksd>where reflutter
     C:\Users\gteksd\AppData\Local\Packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\Scripts\reflutter.exe
     ```

2. **Open Environment Variables**:
   - Right-click on `This PC` or `My Computer` on the desktop or in File Explorer and select `Properties`.
   - Click on `Advanced system settings`.
   - In the System Properties window, click on the `Environment Variables` button.

3. **Edit the PATH Variable**:
   - In the Environment Variables window, find the `Path` variable in the `System variables` section, and select it.
   - Click `Edit`, and in the Edit Environment Variable window, click `New`.

4. **Add reflutter Path**:
   - Add the path to the directory where `reflutter` is located (e.g., `C:\Users\<YourUsername>\AppData\Local\Programs\Python\Python39\Scripts`).
   - In my case it was `C:\Users\gteksd\AppData\Local\Packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\Scripts`

5. **Save and Close**:
   - Click `OK` on all windows to save the changes.


2. After `reflutter` is installed, use the command below along with your Flutter app:

   ```bash
   reflutter your_flutter.apk
   ```
   ```
   Choose an option:

   1. Traffic monitoring and interception
   2. Display absolute code offset for functions

   [1/2]? 1
   ```

3. Then select the "1" option. You need to specify the IP of your Burp Suite Proxy Server located in the same network where the device with the flutter application is. Next, you should configure the Proxy in `BurpSuite -> Listener Proxy -> Options tab`

- Add port: `8083`
- Bind to address: `All interfaces`
- Request handling: Support invisible proxying = `True`
<p align="center"><img src="https://user-images.githubusercontent.com/87244850/135753172-20489ef9-0759-432f-b2fa-220607e896b8.png" width="84%"/></p>

You don't need to install any certificates. On an Android device, you don't need root access as well. reFlutter also allows to bypass some of the flutter certificate pinning implementations.

```
Example: (192.168.1.154) etc.
Please enter your BurpSuite IP: 192.168.1.69

 Wait ...

SnapshotHash: 32400saf9as6fds7r3hru9f8sa963t
The resulting apk file: ./release.RE.apk
Please sign,align the apk file

Configure Burp Suite proxy server to listen on *:8083
Proxy Tab -> Options -> Proxy Listeners -> Edit -> Binding Tab

Then enable invisible proxying in Request Handling Tab
Support Invisible Proxying -> true
```

4. After this step is completed, you will get the `release.RE.apk` file which has SSL pinning mechanisms removed, but this APK is not signed yet. We have to sign it manually.

5. To sign the APK manually, we'll use `uber-apk-signer`. You can download the latest version of it from GitHub. I used version 1.3.0 (which is the latest). Then use the command below:

   ```bash
   java -jar uber-apk-signer-1.3.0.jar --apk release.RE.apk
   ```

6. The signed APK will be named something like `release.RE-aligned-debugSigned.apk`.

   This is our APK file which has SSL pinning bypassed.

7. Install this APK file on your emulator or the device you use for testing. You can simply drag and drop it or use the command below:

   ```bash
   adb install release.RE-aligned-debugSigned.apk
   ```

8. Now, here is the most important part:

   i) Open BurpSuite and go to `Proxy > Options > Add a proxy listener`.
   
   ii) Set the port to `8083` and change the `Bind to address` to `All interfaces`.

   > **Note:** You have to change the port to 8083 because in the image below you can see that it is something reFlutter sets by default.

9. Now, just beside the `Binding` tab, there is another tab called `Request handling`. Click on it and check the `Support invisible proxying` option.

10. Open your Flutter app; it should now communicate through BurpSuite, indicating a successful SSL pinning bypass.
