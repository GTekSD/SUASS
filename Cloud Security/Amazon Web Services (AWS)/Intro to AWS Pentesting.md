# Intro to AWS Pentesting

## AWS Keys

#### What are AWS keys?
- Used to access AWS resources programmatically
- Comprised of
  - Access Key ID
  - Secret Access Key
- Temorary Access Keys
  - aka Temporary Security Credentials
  - Includes Access Key ID and Secret Access Key
    - Also requires a Security Token

#### How do you create keys?
- Create an IAM user in the AWS Management Console
  - Copy straight from the site
  - Download the .csv file

#### Where do you find keys?
- Linux
  - `~/.aws/credentials`
- Windows
  - `%USERPROFILE%\.aws\credentials`
- Google dork
  - https://exploit-db.com/google-hacking-database
- Github
  - Hardcoded in git commits
  - Just sitting there in some repo
- Bitbucket
- Pastebin
- Other AWS services can expose them


## IAM

#### What are IAM users?
- Users other than root user
- Have permissions set for all sorts of things

#### How do you create an IAM user?

#### How do you set access/permissions for an IAM user?

#### Security Issues
- Weak password security
  - Attackers can password spray to gain access the AWS Management Console
- No MFA
- Not rotating access keys
  - Use keys for far too long
  - Old keys aren't disabled/deleted
- Jenky S3 permissions (\requires access to role with these permissions*)
  - `s3:ListAllMyBuckets`
  - `s3:List*`
  - `s3:*`
    - These can be dangerous as they can allow an attacker to find all your s3 buckets
   

## S3

#### What is S3?

#### How do you create an S3 'bucket'?
- Bucket URL
  - http://bucketname.s3.amazonaws.com
  - http://s3.amazonaws.com/bucketname

#### Case studies
- Define 'Leak Hunters'
- https://businessinsights.bitdefender.com/worst-amazon-breaches

#### Current S3 default security
- Defaults to private

#### How do buckets still leak?
- Admins make the bucket public
- Admins change the policy
  - `s3:*`
  - `s3:List*`
  - `s3:ListAllMyBuckets`

#### How do we find S3 buckets?
- Websites can be hosted in S3
  - `nslookup flaws.cloud`
- Website content can be hosted in S3
Check page source
- Google search
  - `site:s3.amazonaws.com`
- Brute Force
  - AWSBucketDump.py
 

## EC2

#### What is EC2?
- Elastic Compute Cloud
- Basically VMs hosted by AWS

#### Why would you used this service?
- The same reasons you would use a physical device
- Very cost effective
- Quick and Easy
    - File server
    - Web Server
    - Programming
    - Test

#### Security issues?
- Compromise of the OS
  - Weak passwords
  - Exposed SSH keys
  - Zero-Day/RCE
    - Lack of updates/patches
  - Web App compromise
  - Sensitive data exposure
- OS Compromise can lead to AWS compromise
  - Attacker can recover sensitive data from EC2 instance
AWS Keys
Other stored creds
  - SSH
  - Database
  - User
- Malicious AMIs
  - Attackers can create malicious Custom AMIs
    - Then trick user into creating instaces with them
   

## Lambda

#### What is Lambda?
- Lambda is a 'serverless' application service
  - Basically a programmatic function that doesn't require the user to build,
    - or maintain a compute environment to perform the function
      - Amazon does it for you with Lambda
        - You just need to provide the code

#### What kinds of things can a Lambda function do?
- Data processing
- Web app functions
- Filter and/or transform data

#### Security issues?
- Input sanitization
  - Injection attacks
- Security misconfigurations
  - Overly permissive
    - No role separation
    - Too much access
  - Exposes sensitive info
- 3rd party libraries
  - They must be checked for security issues and maintained as a separate entity
- DDoS


## ARNs

#### What is an ARN?
- Amazon Resource Name
  - Unique Identifier of an AWS resource
    - https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html

#### Why are ARNs important to us?
- They point us to resources
- They may be required to perform a task
  - All or part of an ARN may be needed to perform a given task

#### Let's discuss the ARN Format
- Partition
- Service
- Region
- Account-ID
- Resource-ID

#### Explain Paths in ARNs
- Paths to a resource
  - S3 resource
    - `:bucket_name/a/path/to/file.txt`
  - Users
    - `:account-id:user/*` = Path to all users
  - Groups
    - `:account-id:group/*` = Path to all groups
   
--------------------

##
